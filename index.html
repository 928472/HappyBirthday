<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ç”Ÿæ—¥è´ºå¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvas-confetti/1.6.0/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Noto Serif SC', serif; color: white; touch-action: none; }
        #canvas-container { position: absolute; inset: 0; z-index: 1; }
        .glass-panel { background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 2.5rem; }
        .neon-text { text-shadow: 0 0 20px #ff69b4, 0 0 40px rgba(255,105,180,0.4); }
        #start-overlay { position: fixed; inset: 0; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 1s; }
        .hidden { display: none !important; }
        .cake-rain { position: fixed; top: -50px; pointer-events: none; z-index: 100; font-size: 2rem; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
        .cake-main { font-size: 8rem; filter: drop-shadow(0 0 30px gold); cursor: pointer; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .cake-main:active { transform: scale(0.8); }
    </style>
</head>
<body>
    <audio id="bgm" loop preload="auto"><source src="./src/happy-birthday-155461.mp3" type="audio/mpeg"></audio>
    <div id="canvas-container"></div>

    <div id="start-overlay">
        <div class="text-center p-14 glass-panel border-pink-500/30">
            <h2 class="text-7xl mb-14 font-bold text-white neon-text">ç”Ÿæ—¥è´ºå¡</h2>
            <button id="start-btn" class="px-20 py-5 bg-white text-black rounded-full font-bold text-2xl hover:bg-pink-500 hover:text-white transition-all shadow-[0_0_30px_rgba(255,255,255,0.3)]">ç‚¹å‡»å¼€å¯ âœ¨</button>
        </div>
    </div>

    <div id="main-ui" class="fixed inset-0 flex flex-col justify-center items-center opacity-0 transition-opacity duration-1000 z-10 px-8 pointer-events-none">
        <div id="text-box" class="glass-panel p-10 max-w-lg w-full text-center mb-8 pointer-events-auto">
            <p id="blessing" class="text-2xl leading-relaxed min-h-[160px] text-pink-50 font-medium tracking-wide"></p>
            <button id="wish-btn" class="hidden mt-8 px-12 py-4 bg-gradient-to-r from-pink-500 to-indigo-600 rounded-full text-white font-bold text-lg shadow-xl hover:scale-105 active:scale-95 transition-transform">è®¸ä¸ªæ„¿å§ ğŸ‚</button>
        </div>

        <div id="cake-area" class="hidden text-center pointer-events-auto">
            <div id="cake-icon" class="cake-main">ğŸ‚</div>
            <p id="final-tip" class="mt-6 text-pink-400 font-bold text-xl animate-pulse">ç‚¹å‡»è›‹ç³•è®¸ä¸‹å¿ƒæ„¿</p>
        </div>
    </div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const wishBtn = document.getElementById('wish-btn');
        const blessingEl = document.getElementById('blessing');
        const bgm = document.getElementById('bgm');
        const text = "å²åºæ›´æ›¿ï¼Œåç« æ—¥æ–°ã€‚æ„¿ä½ æœ‰ç›´é¢æ¸…æ™¨æ—¥å…‰çš„çƒ­å¿±ï¼Œäº¦æœ‰æ¼«æ­¥é»„æ˜ä½™æ™–çš„ä»å®¹ã€‚æ‰€æœ‰çš„ç¾å¥½éƒ½â€œè¯â€ç”Ÿäºæ­¤ï¼Œç¥ä½ ç”Ÿæ—¥å¿«ä¹ã€‚âœ¨";

        // --- THREE.JS æé™æµä½“ç²’å­èƒŒæ™¯ ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 1, 3000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const particlesCount = 10000;
        const positions = new Float32Array(particlesCount * 3);
        const velocities = new Float32Array(particlesCount * 3);
        for(let i=0; i<particlesCount*3; i++) {
            positions[i] = (Math.random() - 0.5) * 2000;
            velocities[i] = (Math.random() - 0.5) * 1.5;
        }

        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        const material = new THREE.PointsMaterial({ color: 0xffb6c1, size: 2, transparent: true, opacity: 0.7, blending: THREE.AdditiveBlending });
        const particleMesh = new THREE.Points(geometry, material);
        scene.add(particleMesh);
        camera.position.z = 1000;

        let mouse = { x: 0, y: 0, active: false };
        const updateMouse = (e) => {
            mouse.x = ((e.clientX || e.touches[0].clientX) / window.innerWidth) * 2 - 1;
            mouse.y = -((e.clientY || e.touches[0].clientY) / window.innerHeight) * 2 + 1;
            mouse.active = true;
        };
        window.addEventListener('mousemove', updateMouse);
        window.addEventListener('touchstart', updateMouse);
        window.addEventListener('touchmove', updateMouse);
        window.addEventListener('touchend', () => mouse.active = false);

        function animate() {
            requestAnimationFrame(animate);
            const pos = particleMesh.geometry.attributes.position.array;
            const targetX = mouse.x * 800;
            const targetY = mouse.y * 500;

            for(let i=0; i<particlesCount; i++) {
                const i3 = i * 3;
                if(mouse.active) {
                    // æé™æµä½“å¸å¼•ï¼šå¸¦é˜»å°¼æ„Ÿçš„å‘å¿ƒåŠ›
                    pos[i3] += (targetX - pos[i3]) * 0.03;
                    pos[i3+1] += (targetY - pos[i3+1]) * 0.03;
                } else {
                    pos[i3] += velocities[i3];
                    pos[i3+1] += velocities[i3+1];
                    if(Math.abs(pos[i3]) > 1200) velocities[i3] *= -1;
                    if(Math.abs(pos[i3+1]) > 800) velocities[i3+1] *= -1;
                }
            }
            particleMesh.geometry.attributes.position.needsUpdate = true;
            particleMesh.rotation.y += 0.001;
            renderer.render(scene, camera);
        }
        animate();

        // --- é€»è¾‘æ§åˆ¶ ---
        startBtn.onclick = () => {
            bgm.play();
            document.getElementById('start-overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('start-overlay').classList.add('hidden');
                document.getElementById('main-ui').style.opacity = '1';
                typeWriter();
            }, 800);
        };

        let idx = 0;
        function typeWriter() {
            if (idx < text.length) {
                blessingEl.innerHTML += text.charAt(idx);
                idx++;
                setTimeout(typeWriter, 90);
            } else {
                wishBtn.classList.remove('hidden');
            }
        }

        // --- è›‹ç³•é›¨å¤§æ‹› ---
        wishBtn.onclick = () => {
            wishBtn.classList.add('hidden');
            document.getElementById('cake-area').classList.remove('hidden');
            
            // è§¦å‘ä¸­é€Ÿè›‹ç³•é›¨
            const icons = ['ğŸ‚', 'ğŸ°', 'ğŸ§', 'ğŸ©', 'ğŸ', 'ğŸ’–'];
            for(let i=0; i<60; i++) {
                setTimeout(() => {
                    const drop = document.createElement('div');
                    drop.className = 'cake-rain';
                    drop.innerHTML = icons[Math.floor(Math.random() * icons.length)];
                    drop.style.left = Math.random() * 100 + 'vw';
                    drop.style.animationDuration = (Math.random() * 3 + 4) + 's'; // ä¸­é€Ÿ 4-7ç§’
                    document.body.appendChild(drop);
                    setTimeout(() => drop.remove(), 7000);
                }, i * 150);
            }
        };

        document.getElementById('cake-icon').onclick = () => {
            confetti({ particleCount: 250, spread: 100, origin: { y: 0.6 }, colors: ['#ff69b4', '#ffffff', '#ffd700'] });
            document.getElementById('cake-icon').innerHTML = 'ğŸ°';
            document.getElementById('final-tip').innerText = "æ„¿æœ›æˆçœŸï¼Œæ°¸è¿œå¼€å¿ƒï¼âœ¨";
        };

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
